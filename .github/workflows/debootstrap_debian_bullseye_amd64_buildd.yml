name: build linux

on:

   push:

    branches: test

jobs:

  build-linux: 

    runs-on: ubuntu-latest

    steps:

      - uses: actions/checkout@v3

      - name: Setup environment

        run: |

          sudo apt update

          sudo apt install -y git apt-transport-https wget binfmt-support debootstrap tar zip unzip xz-utils
      - name: Build linux 

        run: |

          mkdir -p -v rootfs

          sudo chmod 777 -R -v rootfs

          sudo debootstrap --arch amd64 --variant=buildd --include=nano,wget,default-jdk,openjdk-17-jdk,git,vim,automake,cmake,make,build-essential,python2.7-minimal,python2.7,python3,python3-pip,llvm,clang,gcc,g++,shellcheck,fish,debhelper,pkg-config,dpkg-dev bullseye rootfs http://mirrors.ustc.edu.cn/debian/

          sudo chmod 777 -R -v rootfs/root
          sudo chmod 777 -R -v rootfs/etc/*
          sudo rm -rf rootfs/debootstrap/
          sudo cp /etc/resolv.conf rootfs/etc -rv

          sudo echo 'debootstrap_build' > rootfs/etc/hostname
          
          
      - name: Pack linux

        run: |
          sudo chmod 777 -R -v rootfs/
          sudo chmod 777 -R -v rootfs/*
      - name: Upload image to artifact

        uses: actions/upload-artifact@v3

        with:

          name:  debootstrap_debian_bullseye_buildd-`(date +%Y-%m-%d)`

          path: rootfs/*

